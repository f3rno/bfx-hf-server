'use strict';

const send = require('../../util/ws/send');
const sendError = require('../../util/ws/send_error');
const poolUnsubscribe = require('../../ex_pool/unsubscribe');

module.exports = async (server, ws, msg) => {
  const { d, pool } = server;
  const [, exID, channel] = msg;

  let chanID;

  try {
    chanID = await poolUnsubscribe({ pool, exID, channel });
  } catch (err) {
    d('error unsubscribing from %s %j: %s', exID, channel, err.stack);
    return sendError(ws, 'internal error subscribing');
  }

  delete ws.subscriptions[exID][`${chanID}`];
  send(ws, ['unsubscribed', exID, chanID, channel]);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy93c19zZXJ2ZXJzL2V4X3Bvb2wvb25fdW5zdWJzY3JpYmUuanMiXSwibmFtZXMiOlsic2VuZCIsInJlcXVpcmUiLCJzZW5kRXJyb3IiLCJwb29sVW5zdWJzY3JpYmUiLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmVyIiwid3MiLCJtc2ciLCJkIiwicG9vbCIsImV4SUQiLCJjaGFubmVsIiwiY2hhbklEIiwiZXJyIiwic3RhY2siLCJzdWJzY3JpcHRpb25zIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxvQkFBRCxDQUFwQjtBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLDBCQUFELENBQXpCO0FBQ0EsTUFBTUUsZUFBZSxHQUFHRixPQUFPLENBQUMsMkJBQUQsQ0FBL0I7O0FBRUFHLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPQyxNQUFQLEVBQWVDLEVBQWYsRUFBbUJDLEdBQW5CLEtBQTJCO0FBQzFDLFFBQU0sRUFBRUMsQ0FBRixFQUFLQyxJQUFMLEtBQWNKLE1BQXBCO0FBQ0EsUUFBTSxHQUFHSyxJQUFILEVBQVNDLE9BQVQsSUFBb0JKLEdBQTFCOztBQUVBLE1BQUlLLE1BQUo7O0FBRUEsTUFBSTtBQUNGQSxJQUFBQSxNQUFNLEdBQUcsTUFBTVYsZUFBZSxDQUFDLEVBQUVPLElBQUYsRUFBUUMsSUFBUixFQUFjQyxPQUFkLEVBQUQsQ0FBOUI7QUFDRCxHQUZELENBRUUsT0FBT0UsR0FBUCxFQUFZO0FBQ1pMLElBQUFBLENBQUMsQ0FBQyxvQ0FBRCxFQUF1Q0UsSUFBdkMsRUFBNkNDLE9BQTdDLEVBQXNERSxHQUFHLENBQUNDLEtBQTFELENBQUQ7QUFDQSxXQUFPYixTQUFTLENBQUNLLEVBQUQsRUFBSyw0QkFBTCxDQUFoQjtBQUNEOztBQUVELFNBQU9BLEVBQUUsQ0FBQ1MsYUFBSCxDQUFpQkwsSUFBakIsRUFBd0IsR0FBRUUsTUFBTyxFQUFqQyxDQUFQO0FBQ0FiLEVBQUFBLElBQUksQ0FBQ08sRUFBRCxFQUFLLENBQUMsY0FBRCxFQUFpQkksSUFBakIsRUFBdUJFLE1BQXZCLEVBQStCRCxPQUEvQixDQUFMLENBQUo7QUFDRCxDQWZEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IHNlbmQgPSByZXF1aXJlKCcuLi8uLi91dGlsL3dzL3NlbmQnKVxuY29uc3Qgc2VuZEVycm9yID0gcmVxdWlyZSgnLi4vLi4vdXRpbC93cy9zZW5kX2Vycm9yJylcbmNvbnN0IHBvb2xVbnN1YnNjcmliZSA9IHJlcXVpcmUoJy4uLy4uL2V4X3Bvb2wvdW5zdWJzY3JpYmUnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChzZXJ2ZXIsIHdzLCBtc2cpID0+IHtcbiAgY29uc3QgeyBkLCBwb29sIH0gPSBzZXJ2ZXJcbiAgY29uc3QgWywgZXhJRCwgY2hhbm5lbF0gPSBtc2dcblxuICBsZXQgY2hhbklEXG5cbiAgdHJ5IHtcbiAgICBjaGFuSUQgPSBhd2FpdCBwb29sVW5zdWJzY3JpYmUoeyBwb29sLCBleElELCBjaGFubmVsIH0pXG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGQoJ2Vycm9yIHVuc3Vic2NyaWJpbmcgZnJvbSAlcyAlajogJXMnLCBleElELCBjaGFubmVsLCBlcnIuc3RhY2spXG4gICAgcmV0dXJuIHNlbmRFcnJvcih3cywgJ2ludGVybmFsIGVycm9yIHN1YnNjcmliaW5nJylcbiAgfVxuXG4gIGRlbGV0ZSB3cy5zdWJzY3JpcHRpb25zW2V4SURdW2Ake2NoYW5JRH1gXVxuICBzZW5kKHdzLCBbJ3Vuc3Vic2NyaWJlZCcsIGV4SUQsIGNoYW5JRCwgY2hhbm5lbF0pXG59XG4iXX0=