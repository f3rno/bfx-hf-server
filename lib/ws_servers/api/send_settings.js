'use strict';

const { _default } = require('bfx-hf-ui-config').UserSettings;

const send = require('../../util/ws/send');
const sendError = require('../../util/ws/send_error');
const isAuthorized = require('../../util/ws/is_authorized');

module.exports = async (server, ws, msg) => {
  const { db } = server;
  const { UserSettings } = db;
  const [, authToken] = msg;

  if (!isAuthorized(ws, authToken)) {
    return sendError(ws, 'Unauthorized');
  }

  const { userSettings } = await UserSettings.getAll();
  send(ws, ['data.settings.updated', userSettings || _default]);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy93c19zZXJ2ZXJzL2FwaS9zZW5kX3NldHRpbmdzLmpzIl0sIm5hbWVzIjpbIl9kZWZhdWx0IiwicmVxdWlyZSIsIlVzZXJTZXR0aW5ncyIsInNlbmQiLCJzZW5kRXJyb3IiLCJpc0F1dGhvcml6ZWQiLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmVyIiwid3MiLCJtc2ciLCJkYiIsImF1dGhUb2tlbiIsInVzZXJTZXR0aW5ncyIsImdldEFsbCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTSxFQUFFQSxRQUFGLEtBQWVDLE9BQU8sQ0FBQyxrQkFBRCxDQUFQLENBQTRCQyxZQUFqRDs7QUFFQSxNQUFNQyxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxvQkFBRCxDQUFwQjtBQUNBLE1BQU1HLFNBQVMsR0FBR0gsT0FBTyxDQUFDLDBCQUFELENBQXpCO0FBQ0EsTUFBTUksWUFBWSxHQUFHSixPQUFPLENBQUMsNkJBQUQsQ0FBNUI7O0FBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPQyxNQUFQLEVBQWVDLEVBQWYsRUFBbUJDLEdBQW5CLEtBQTJCO0FBQzFDLFFBQU0sRUFBRUMsRUFBRixLQUFTSCxNQUFmO0FBQ0EsUUFBTSxFQUFFTixZQUFGLEtBQW1CUyxFQUF6QjtBQUNBLFFBQU0sR0FBR0MsU0FBSCxJQUFnQkYsR0FBdEI7O0FBRUEsTUFBSSxDQUFDTCxZQUFZLENBQUNJLEVBQUQsRUFBS0csU0FBTCxDQUFqQixFQUFrQztBQUNoQyxXQUFPUixTQUFTLENBQUNLLEVBQUQsRUFBSyxjQUFMLENBQWhCO0FBQ0Q7O0FBRUQsUUFBTSxFQUFFSSxZQUFGLEtBQW1CLE1BQU1YLFlBQVksQ0FBQ1ksTUFBYixFQUEvQjtBQUNBWCxFQUFBQSxJQUFJLENBQUNNLEVBQUQsRUFBSyxDQUFDLHVCQUFELEVBQTBCSSxZQUFZLElBQUliLFFBQTFDLENBQUwsQ0FBSjtBQUNELENBWEQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuY29uc3QgeyBfZGVmYXVsdCB9ID0gcmVxdWlyZSgnYmZ4LWhmLXVpLWNvbmZpZycpLlVzZXJTZXR0aW5nc1xuXG5jb25zdCBzZW5kID0gcmVxdWlyZSgnLi4vLi4vdXRpbC93cy9zZW5kJylcbmNvbnN0IHNlbmRFcnJvciA9IHJlcXVpcmUoJy4uLy4uL3V0aWwvd3Mvc2VuZF9lcnJvcicpXG5jb25zdCBpc0F1dGhvcml6ZWQgPSByZXF1aXJlKCcuLi8uLi91dGlsL3dzL2lzX2F1dGhvcml6ZWQnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jIChzZXJ2ZXIsIHdzLCBtc2cpID0+IHtcbiAgY29uc3QgeyBkYiB9ID0gc2VydmVyXG4gIGNvbnN0IHsgVXNlclNldHRpbmdzIH0gPSBkYlxuICBjb25zdCBbLCBhdXRoVG9rZW5dID0gbXNnXG5cbiAgaWYgKCFpc0F1dGhvcml6ZWQod3MsIGF1dGhUb2tlbikpIHtcbiAgICByZXR1cm4gc2VuZEVycm9yKHdzLCAnVW5hdXRob3JpemVkJylcbiAgfVxuXG4gIGNvbnN0IHsgdXNlclNldHRpbmdzIH0gPSBhd2FpdCBVc2VyU2V0dGluZ3MuZ2V0QWxsKClcbiAgc2VuZCh3cywgWydkYXRhLnNldHRpbmdzLnVwZGF0ZWQnLCB1c2VyU2V0dGluZ3MgfHwgX2RlZmF1bHRdKVxufVxuIl19