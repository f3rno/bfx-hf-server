'use strict';

const validateParams = require('../../../util/ws/validate_params');
const addPoolClient = require('../../../ws_clients/ex_pool/add_client');

module.exports = (server, ws, msg) => {
  const [, exID, channelData] = msg;
  const validRequest = validateParams(ws, {
    exID: { type: 'string', v: exID },
    channelData: { type: 'object', v: channelData } });


  if (!validRequest) {
    return;
  }

  const poolMessage = ['sub', exID, channelData];
  const { pc } = server;

  if (!ws.subscriptions) ws.subscriptions = {};
  if (!ws.subscriptions[exID]) ws.subscriptions[exID] = [];

  ws.subscriptions[exID].push(channelData);

  addPoolClient(pc, exID, channelData, ws);
  pc.send(poolMessage);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy93c19zZXJ2ZXJzL2FwaS9oYW5kbGVycy9vbl9zdWJzY3JpYmUuanMiXSwibmFtZXMiOlsidmFsaWRhdGVQYXJhbXMiLCJyZXF1aXJlIiwiYWRkUG9vbENsaWVudCIsIm1vZHVsZSIsImV4cG9ydHMiLCJzZXJ2ZXIiLCJ3cyIsIm1zZyIsImV4SUQiLCJjaGFubmVsRGF0YSIsInZhbGlkUmVxdWVzdCIsInR5cGUiLCJ2IiwicG9vbE1lc3NhZ2UiLCJwYyIsInN1YnNjcmlwdGlvbnMiLCJwdXNoIiwic2VuZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsY0FBYyxHQUFHQyxPQUFPLENBQUMsa0NBQUQsQ0FBOUI7QUFDQSxNQUFNQyxhQUFhLEdBQUdELE9BQU8sQ0FBQyx3Q0FBRCxDQUE3Qjs7QUFFQUUsTUFBTSxDQUFDQyxPQUFQLEdBQWlCLENBQUNDLE1BQUQsRUFBU0MsRUFBVCxFQUFhQyxHQUFiLEtBQXFCO0FBQ3BDLFFBQU0sR0FBR0MsSUFBSCxFQUFTQyxXQUFULElBQXdCRixHQUE5QjtBQUNBLFFBQU1HLFlBQVksR0FBR1YsY0FBYyxDQUFDTSxFQUFELEVBQUs7QUFDdENFLElBQUFBLElBQUksRUFBRSxFQUFFRyxJQUFJLEVBQUUsUUFBUixFQUFrQkMsQ0FBQyxFQUFFSixJQUFyQixFQURnQztBQUV0Q0MsSUFBQUEsV0FBVyxFQUFFLEVBQUVFLElBQUksRUFBRSxRQUFSLEVBQWtCQyxDQUFDLEVBQUVILFdBQXJCLEVBRnlCLEVBQUwsQ0FBbkM7OztBQUtBLE1BQUksQ0FBQ0MsWUFBTCxFQUFtQjtBQUNqQjtBQUNEOztBQUVELFFBQU1HLFdBQVcsR0FBRyxDQUFDLEtBQUQsRUFBUUwsSUFBUixFQUFjQyxXQUFkLENBQXBCO0FBQ0EsUUFBTSxFQUFFSyxFQUFGLEtBQVNULE1BQWY7O0FBRUEsTUFBSSxDQUFDQyxFQUFFLENBQUNTLGFBQVIsRUFBdUJULEVBQUUsQ0FBQ1MsYUFBSCxHQUFtQixFQUFuQjtBQUN2QixNQUFJLENBQUNULEVBQUUsQ0FBQ1MsYUFBSCxDQUFpQlAsSUFBakIsQ0FBTCxFQUE2QkYsRUFBRSxDQUFDUyxhQUFILENBQWlCUCxJQUFqQixJQUF5QixFQUF6Qjs7QUFFN0JGLEVBQUFBLEVBQUUsQ0FBQ1MsYUFBSCxDQUFpQlAsSUFBakIsRUFBdUJRLElBQXZCLENBQTRCUCxXQUE1Qjs7QUFFQVAsRUFBQUEsYUFBYSxDQUFDWSxFQUFELEVBQUtOLElBQUwsRUFBV0MsV0FBWCxFQUF3QkgsRUFBeEIsQ0FBYjtBQUNBUSxFQUFBQSxFQUFFLENBQUNHLElBQUgsQ0FBUUosV0FBUjtBQUNELENBckJEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IHZhbGlkYXRlUGFyYW1zID0gcmVxdWlyZSgnLi4vLi4vLi4vdXRpbC93cy92YWxpZGF0ZV9wYXJhbXMnKVxuY29uc3QgYWRkUG9vbENsaWVudCA9IHJlcXVpcmUoJy4uLy4uLy4uL3dzX2NsaWVudHMvZXhfcG9vbC9hZGRfY2xpZW50JylcblxubW9kdWxlLmV4cG9ydHMgPSAoc2VydmVyLCB3cywgbXNnKSA9PiB7XG4gIGNvbnN0IFssIGV4SUQsIGNoYW5uZWxEYXRhXSA9IG1zZ1xuICBjb25zdCB2YWxpZFJlcXVlc3QgPSB2YWxpZGF0ZVBhcmFtcyh3cywge1xuICAgIGV4SUQ6IHsgdHlwZTogJ3N0cmluZycsIHY6IGV4SUQgfSxcbiAgICBjaGFubmVsRGF0YTogeyB0eXBlOiAnb2JqZWN0JywgdjogY2hhbm5lbERhdGEgfVxuICB9KVxuXG4gIGlmICghdmFsaWRSZXF1ZXN0KSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBjb25zdCBwb29sTWVzc2FnZSA9IFsnc3ViJywgZXhJRCwgY2hhbm5lbERhdGFdXG4gIGNvbnN0IHsgcGMgfSA9IHNlcnZlclxuXG4gIGlmICghd3Muc3Vic2NyaXB0aW9ucykgd3Muc3Vic2NyaXB0aW9ucyA9IHt9XG4gIGlmICghd3Muc3Vic2NyaXB0aW9uc1tleElEXSkgd3Muc3Vic2NyaXB0aW9uc1tleElEXSA9IFtdXG5cbiAgd3Muc3Vic2NyaXB0aW9uc1tleElEXS5wdXNoKGNoYW5uZWxEYXRhKVxuXG4gIGFkZFBvb2xDbGllbnQocGMsIGV4SUQsIGNoYW5uZWxEYXRhLCB3cylcbiAgcGMuc2VuZChwb29sTWVzc2FnZSlcbn1cbiJdfQ==