'use strict';

const sendError = require('../../../util/ws/send_error');
const validateParams = require('../../../util/ws/validate_params');
const isAuthorized = require('../../../util/ws/is_authorized');

module.exports = async (server, ws, msg) => {
  const [, authToken, exID, aoID, packet] = msg;
  const validRequest = validateParams(ws, {
    exID: { type: 'string', v: exID },
    authToken: { type: 'string', v: authToken },
    aoID: { type: 'string', v: aoID },
    packet: { type: 'object', v: packet } });


  if (!validRequest) {
    return;
  }

  if (!isAuthorized(ws, authToken)) {
    return sendError(ws, 'Unauthorized');
  } else if (exID !== 'bitfinex' && exID !== 'binance') {
    return sendError(ws, 'Algo orders currently only enabled for Bitfinex and Binance');
  } else if (!ws.aoc) {
    return sendError(ws, 'Unauthorized');
  }

  ws.aoc.startAO(exID, aoID, packet);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy93c19zZXJ2ZXJzL2FwaS9oYW5kbGVycy9vbl9hbGdvX29yZGVyX3N1Ym1pdC5qcyJdLCJuYW1lcyI6WyJzZW5kRXJyb3IiLCJyZXF1aXJlIiwidmFsaWRhdGVQYXJhbXMiLCJpc0F1dGhvcml6ZWQiLCJtb2R1bGUiLCJleHBvcnRzIiwic2VydmVyIiwid3MiLCJtc2ciLCJhdXRoVG9rZW4iLCJleElEIiwiYW9JRCIsInBhY2tldCIsInZhbGlkUmVxdWVzdCIsInR5cGUiLCJ2IiwiYW9jIiwic3RhcnRBTyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsU0FBUyxHQUFHQyxPQUFPLENBQUMsNkJBQUQsQ0FBekI7QUFDQSxNQUFNQyxjQUFjLEdBQUdELE9BQU8sQ0FBQyxrQ0FBRCxDQUE5QjtBQUNBLE1BQU1FLFlBQVksR0FBR0YsT0FBTyxDQUFDLGdDQUFELENBQTVCOztBQUVBRyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsT0FBT0MsTUFBUCxFQUFlQyxFQUFmLEVBQW1CQyxHQUFuQixLQUEyQjtBQUMxQyxRQUFNLEdBQUdDLFNBQUgsRUFBY0MsSUFBZCxFQUFvQkMsSUFBcEIsRUFBMEJDLE1BQTFCLElBQW9DSixHQUExQztBQUNBLFFBQU1LLFlBQVksR0FBR1gsY0FBYyxDQUFDSyxFQUFELEVBQUs7QUFDdENHLElBQUFBLElBQUksRUFBRSxFQUFFSSxJQUFJLEVBQUUsUUFBUixFQUFrQkMsQ0FBQyxFQUFFTCxJQUFyQixFQURnQztBQUV0Q0QsSUFBQUEsU0FBUyxFQUFFLEVBQUVLLElBQUksRUFBRSxRQUFSLEVBQWtCQyxDQUFDLEVBQUVOLFNBQXJCLEVBRjJCO0FBR3RDRSxJQUFBQSxJQUFJLEVBQUUsRUFBRUcsSUFBSSxFQUFFLFFBQVIsRUFBa0JDLENBQUMsRUFBRUosSUFBckIsRUFIZ0M7QUFJdENDLElBQUFBLE1BQU0sRUFBRSxFQUFFRSxJQUFJLEVBQUUsUUFBUixFQUFrQkMsQ0FBQyxFQUFFSCxNQUFyQixFQUo4QixFQUFMLENBQW5DOzs7QUFPQSxNQUFJLENBQUNDLFlBQUwsRUFBbUI7QUFDakI7QUFDRDs7QUFFRCxNQUFJLENBQUNWLFlBQVksQ0FBQ0ksRUFBRCxFQUFLRSxTQUFMLENBQWpCLEVBQWtDO0FBQ2hDLFdBQU9ULFNBQVMsQ0FBQ08sRUFBRCxFQUFLLGNBQUwsQ0FBaEI7QUFDRCxHQUZELE1BRU8sSUFBSUcsSUFBSSxLQUFLLFVBQVQsSUFBdUJBLElBQUksS0FBSyxTQUFwQyxFQUErQztBQUNwRCxXQUFPVixTQUFTLENBQUNPLEVBQUQsRUFBSyw2REFBTCxDQUFoQjtBQUNELEdBRk0sTUFFQSxJQUFJLENBQUNBLEVBQUUsQ0FBQ1MsR0FBUixFQUFhO0FBQ2xCLFdBQU9oQixTQUFTLENBQUNPLEVBQUQsRUFBSyxjQUFMLENBQWhCO0FBQ0Q7O0FBRURBLEVBQUFBLEVBQUUsQ0FBQ1MsR0FBSCxDQUFPQyxPQUFQLENBQWVQLElBQWYsRUFBcUJDLElBQXJCLEVBQTJCQyxNQUEzQjtBQUNELENBdEJEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IHNlbmRFcnJvciA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWwvd3Mvc2VuZF9lcnJvcicpXG5jb25zdCB2YWxpZGF0ZVBhcmFtcyA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWwvd3MvdmFsaWRhdGVfcGFyYW1zJylcbmNvbnN0IGlzQXV0aG9yaXplZCA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWwvd3MvaXNfYXV0aG9yaXplZCcpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKHNlcnZlciwgd3MsIG1zZykgPT4ge1xuICBjb25zdCBbLCBhdXRoVG9rZW4sIGV4SUQsIGFvSUQsIHBhY2tldF0gPSBtc2dcbiAgY29uc3QgdmFsaWRSZXF1ZXN0ID0gdmFsaWRhdGVQYXJhbXMod3MsIHtcbiAgICBleElEOiB7IHR5cGU6ICdzdHJpbmcnLCB2OiBleElEIH0sXG4gICAgYXV0aFRva2VuOiB7IHR5cGU6ICdzdHJpbmcnLCB2OiBhdXRoVG9rZW4gfSxcbiAgICBhb0lEOiB7IHR5cGU6ICdzdHJpbmcnLCB2OiBhb0lEIH0sXG4gICAgcGFja2V0OiB7IHR5cGU6ICdvYmplY3QnLCB2OiBwYWNrZXQgfVxuICB9KVxuXG4gIGlmICghdmFsaWRSZXF1ZXN0KSB7XG4gICAgcmV0dXJuXG4gIH1cblxuICBpZiAoIWlzQXV0aG9yaXplZCh3cywgYXV0aFRva2VuKSkge1xuICAgIHJldHVybiBzZW5kRXJyb3Iod3MsICdVbmF1dGhvcml6ZWQnKVxuICB9IGVsc2UgaWYgKGV4SUQgIT09ICdiaXRmaW5leCcgJiYgZXhJRCAhPT0gJ2JpbmFuY2UnKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvcih3cywgJ0FsZ28gb3JkZXJzIGN1cnJlbnRseSBvbmx5IGVuYWJsZWQgZm9yIEJpdGZpbmV4IGFuZCBCaW5hbmNlJylcbiAgfSBlbHNlIGlmICghd3MuYW9jKSB7XG4gICAgcmV0dXJuIHNlbmRFcnJvcih3cywgJ1VuYXV0aG9yaXplZCcpXG4gIH1cblxuICB3cy5hb2Muc3RhcnRBTyhleElELCBhb0lELCBwYWNrZXQpXG59XG4iXX0=