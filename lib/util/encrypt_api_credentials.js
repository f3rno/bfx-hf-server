'use strict';

const AES = require('aes-js');
const genAESKey = require('./gen_aes_key');

module.exports = async ({ exID, password, key, secret }) => {
  const aesKey = await genAESKey(password);

  const aesCTR = new AES.ModeOfOperation.ctr(aesKey); // eslint-disable-line
  const exIDBytes = AES.utils.utf8.toBytes(exID);
  const keyBytes = AES.utils.utf8.toBytes(key);
  const secretBytes = AES.utils.utf8.toBytes(secret);
  const controlBytes = AES.utils.utf8.toBytes('control');
  const exIDCipherText = AES.utils.hex.fromBytes(aesCTR.encrypt(exIDBytes));
  const keyCipherText = AES.utils.hex.fromBytes(aesCTR.encrypt(keyBytes));
  const secretCipherText = AES.utils.hex.fromBytes(aesCTR.encrypt(secretBytes));
  const controlCipherText = AES.utils.hex.fromBytes(aesCTR.encrypt(controlBytes));

  return {
    cid: exIDCipherText,
    key: keyCipherText,
    secret: secretCipherText,
    meta: controlCipherText };

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2VuY3J5cHRfYXBpX2NyZWRlbnRpYWxzLmpzIl0sIm5hbWVzIjpbIkFFUyIsInJlcXVpcmUiLCJnZW5BRVNLZXkiLCJtb2R1bGUiLCJleHBvcnRzIiwiZXhJRCIsInBhc3N3b3JkIiwia2V5Iiwic2VjcmV0IiwiYWVzS2V5IiwiYWVzQ1RSIiwiTW9kZU9mT3BlcmF0aW9uIiwiY3RyIiwiZXhJREJ5dGVzIiwidXRpbHMiLCJ1dGY4IiwidG9CeXRlcyIsImtleUJ5dGVzIiwic2VjcmV0Qnl0ZXMiLCJjb250cm9sQnl0ZXMiLCJleElEQ2lwaGVyVGV4dCIsImhleCIsImZyb21CeXRlcyIsImVuY3J5cHQiLCJrZXlDaXBoZXJUZXh0Iiwic2VjcmV0Q2lwaGVyVGV4dCIsImNvbnRyb2xDaXBoZXJUZXh0IiwiY2lkIiwibWV0YSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFuQjtBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBekI7O0FBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPLEVBQUVDLElBQUYsRUFBUUMsUUFBUixFQUFrQkMsR0FBbEIsRUFBdUJDLE1BQXZCLEVBQVAsS0FBMkM7QUFDMUQsUUFBTUMsTUFBTSxHQUFHLE1BQU1QLFNBQVMsQ0FBQ0ksUUFBRCxDQUE5Qjs7QUFFQSxRQUFNSSxNQUFNLEdBQUcsSUFBSVYsR0FBRyxDQUFDVyxlQUFKLENBQW9CQyxHQUF4QixDQUE0QkgsTUFBNUIsQ0FBZixDQUgwRCxDQUdQO0FBQ25ELFFBQU1JLFNBQVMsR0FBR2IsR0FBRyxDQUFDYyxLQUFKLENBQVVDLElBQVYsQ0FBZUMsT0FBZixDQUF1QlgsSUFBdkIsQ0FBbEI7QUFDQSxRQUFNWSxRQUFRLEdBQUdqQixHQUFHLENBQUNjLEtBQUosQ0FBVUMsSUFBVixDQUFlQyxPQUFmLENBQXVCVCxHQUF2QixDQUFqQjtBQUNBLFFBQU1XLFdBQVcsR0FBR2xCLEdBQUcsQ0FBQ2MsS0FBSixDQUFVQyxJQUFWLENBQWVDLE9BQWYsQ0FBdUJSLE1BQXZCLENBQXBCO0FBQ0EsUUFBTVcsWUFBWSxHQUFHbkIsR0FBRyxDQUFDYyxLQUFKLENBQVVDLElBQVYsQ0FBZUMsT0FBZixDQUF1QixTQUF2QixDQUFyQjtBQUNBLFFBQU1JLGNBQWMsR0FBR3BCLEdBQUcsQ0FBQ2MsS0FBSixDQUFVTyxHQUFWLENBQWNDLFNBQWQsQ0FBd0JaLE1BQU0sQ0FBQ2EsT0FBUCxDQUFlVixTQUFmLENBQXhCLENBQXZCO0FBQ0EsUUFBTVcsYUFBYSxHQUFHeEIsR0FBRyxDQUFDYyxLQUFKLENBQVVPLEdBQVYsQ0FBY0MsU0FBZCxDQUF3QlosTUFBTSxDQUFDYSxPQUFQLENBQWVOLFFBQWYsQ0FBeEIsQ0FBdEI7QUFDQSxRQUFNUSxnQkFBZ0IsR0FBR3pCLEdBQUcsQ0FBQ2MsS0FBSixDQUFVTyxHQUFWLENBQWNDLFNBQWQsQ0FBd0JaLE1BQU0sQ0FBQ2EsT0FBUCxDQUFlTCxXQUFmLENBQXhCLENBQXpCO0FBQ0EsUUFBTVEsaUJBQWlCLEdBQUcxQixHQUFHLENBQUNjLEtBQUosQ0FBVU8sR0FBVixDQUFjQyxTQUFkLENBQXdCWixNQUFNLENBQUNhLE9BQVAsQ0FBZUosWUFBZixDQUF4QixDQUExQjs7QUFFQSxTQUFPO0FBQ0xRLElBQUFBLEdBQUcsRUFBRVAsY0FEQTtBQUVMYixJQUFBQSxHQUFHLEVBQUVpQixhQUZBO0FBR0xoQixJQUFBQSxNQUFNLEVBQUVpQixnQkFISDtBQUlMRyxJQUFBQSxJQUFJLEVBQUVGLGlCQUpELEVBQVA7O0FBTUQsQ0FuQkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuY29uc3QgQUVTID0gcmVxdWlyZSgnYWVzLWpzJylcbmNvbnN0IGdlbkFFU0tleSA9IHJlcXVpcmUoJy4vZ2VuX2Flc19rZXknKVxuXG5tb2R1bGUuZXhwb3J0cyA9IGFzeW5jICh7IGV4SUQsIHBhc3N3b3JkLCBrZXksIHNlY3JldCB9KSA9PiB7XG4gIGNvbnN0IGFlc0tleSA9IGF3YWl0IGdlbkFFU0tleShwYXNzd29yZClcblxuICBjb25zdCBhZXNDVFIgPSBuZXcgQUVTLk1vZGVPZk9wZXJhdGlvbi5jdHIoYWVzS2V5KSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGNvbnN0IGV4SURCeXRlcyA9IEFFUy51dGlscy51dGY4LnRvQnl0ZXMoZXhJRClcbiAgY29uc3Qga2V5Qnl0ZXMgPSBBRVMudXRpbHMudXRmOC50b0J5dGVzKGtleSlcbiAgY29uc3Qgc2VjcmV0Qnl0ZXMgPSBBRVMudXRpbHMudXRmOC50b0J5dGVzKHNlY3JldClcbiAgY29uc3QgY29udHJvbEJ5dGVzID0gQUVTLnV0aWxzLnV0ZjgudG9CeXRlcygnY29udHJvbCcpXG4gIGNvbnN0IGV4SURDaXBoZXJUZXh0ID0gQUVTLnV0aWxzLmhleC5mcm9tQnl0ZXMoYWVzQ1RSLmVuY3J5cHQoZXhJREJ5dGVzKSlcbiAgY29uc3Qga2V5Q2lwaGVyVGV4dCA9IEFFUy51dGlscy5oZXguZnJvbUJ5dGVzKGFlc0NUUi5lbmNyeXB0KGtleUJ5dGVzKSlcbiAgY29uc3Qgc2VjcmV0Q2lwaGVyVGV4dCA9IEFFUy51dGlscy5oZXguZnJvbUJ5dGVzKGFlc0NUUi5lbmNyeXB0KHNlY3JldEJ5dGVzKSlcbiAgY29uc3QgY29udHJvbENpcGhlclRleHQgPSBBRVMudXRpbHMuaGV4LmZyb21CeXRlcyhhZXNDVFIuZW5jcnlwdChjb250cm9sQnl0ZXMpKVxuXG4gIHJldHVybiB7XG4gICAgY2lkOiBleElEQ2lwaGVyVGV4dCxcbiAgICBrZXk6IGtleUNpcGhlclRleHQsXG4gICAgc2VjcmV0OiBzZWNyZXRDaXBoZXJUZXh0LFxuICAgIG1ldGE6IGNvbnRyb2xDaXBoZXJUZXh0XG4gIH1cbn1cbiJdfQ==