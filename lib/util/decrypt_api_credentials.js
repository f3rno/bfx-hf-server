'use strict';

const AES = require('aes-js');
const genAESKey = require('./gen_aes_key');

module.exports = async ({ password, credentials }) => {
  const { cid, key, secret, meta } = credentials;
  const aesKey = await genAESKey(password);

  const aesCTR = new AES.ModeOfOperation.ctr(aesKey); // eslint-disable-line
  const decryptedExID = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(cid)));
  const decryptedKey = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(key)));
  const decryptedSecret = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(secret)));
  const decryptedControl = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(meta)));

  if (decryptedControl !== 'control') {
    return null;
  }

  return {
    exID: decryptedExID,
    key: decryptedKey,
    secret: decryptedSecret };

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2RlY3J5cHRfYXBpX2NyZWRlbnRpYWxzLmpzIl0sIm5hbWVzIjpbIkFFUyIsInJlcXVpcmUiLCJnZW5BRVNLZXkiLCJtb2R1bGUiLCJleHBvcnRzIiwicGFzc3dvcmQiLCJjcmVkZW50aWFscyIsImNpZCIsImtleSIsInNlY3JldCIsIm1ldGEiLCJhZXNLZXkiLCJhZXNDVFIiLCJNb2RlT2ZPcGVyYXRpb24iLCJjdHIiLCJkZWNyeXB0ZWRFeElEIiwidXRpbHMiLCJ1dGY4IiwiZnJvbUJ5dGVzIiwiZGVjcnlwdCIsImhleCIsInRvQnl0ZXMiLCJkZWNyeXB0ZWRLZXkiLCJkZWNyeXB0ZWRTZWNyZXQiLCJkZWNyeXB0ZWRDb250cm9sIiwiZXhJRCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFuQjtBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBekI7O0FBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPLEVBQUVDLFFBQUYsRUFBWUMsV0FBWixFQUFQLEtBQXFDO0FBQ3BELFFBQU0sRUFBRUMsR0FBRixFQUFPQyxHQUFQLEVBQVlDLE1BQVosRUFBb0JDLElBQXBCLEtBQTZCSixXQUFuQztBQUNBLFFBQU1LLE1BQU0sR0FBRyxNQUFNVCxTQUFTLENBQUNHLFFBQUQsQ0FBOUI7O0FBRUEsUUFBTU8sTUFBTSxHQUFHLElBQUlaLEdBQUcsQ0FBQ2EsZUFBSixDQUFvQkMsR0FBeEIsQ0FBNEJILE1BQTVCLENBQWYsQ0FKb0QsQ0FJRDtBQUNuRCxRQUFNSSxhQUFhLEdBQUdmLEdBQUcsQ0FBQ2dCLEtBQUosQ0FBVUMsSUFBVixDQUFlQyxTQUFmLENBQXlCTixNQUFNLENBQUNPLE9BQVAsQ0FBZW5CLEdBQUcsQ0FBQ2dCLEtBQUosQ0FBVUksR0FBVixDQUFjQyxPQUFkLENBQXNCZCxHQUF0QixDQUFmLENBQXpCLENBQXRCO0FBQ0EsUUFBTWUsWUFBWSxHQUFHdEIsR0FBRyxDQUFDZ0IsS0FBSixDQUFVQyxJQUFWLENBQWVDLFNBQWYsQ0FBeUJOLE1BQU0sQ0FBQ08sT0FBUCxDQUFlbkIsR0FBRyxDQUFDZ0IsS0FBSixDQUFVSSxHQUFWLENBQWNDLE9BQWQsQ0FBc0JiLEdBQXRCLENBQWYsQ0FBekIsQ0FBckI7QUFDQSxRQUFNZSxlQUFlLEdBQUd2QixHQUFHLENBQUNnQixLQUFKLENBQVVDLElBQVYsQ0FBZUMsU0FBZixDQUF5Qk4sTUFBTSxDQUFDTyxPQUFQLENBQWVuQixHQUFHLENBQUNnQixLQUFKLENBQVVJLEdBQVYsQ0FBY0MsT0FBZCxDQUFzQlosTUFBdEIsQ0FBZixDQUF6QixDQUF4QjtBQUNBLFFBQU1lLGdCQUFnQixHQUFHeEIsR0FBRyxDQUFDZ0IsS0FBSixDQUFVQyxJQUFWLENBQWVDLFNBQWYsQ0FBeUJOLE1BQU0sQ0FBQ08sT0FBUCxDQUFlbkIsR0FBRyxDQUFDZ0IsS0FBSixDQUFVSSxHQUFWLENBQWNDLE9BQWQsQ0FBc0JYLElBQXRCLENBQWYsQ0FBekIsQ0FBekI7O0FBRUEsTUFBSWMsZ0JBQWdCLEtBQUssU0FBekIsRUFBb0M7QUFDbEMsV0FBTyxJQUFQO0FBQ0Q7O0FBRUQsU0FBTztBQUNMQyxJQUFBQSxJQUFJLEVBQUVWLGFBREQ7QUFFTFAsSUFBQUEsR0FBRyxFQUFFYyxZQUZBO0FBR0xiLElBQUFBLE1BQU0sRUFBRWMsZUFISCxFQUFQOztBQUtELENBbkJEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IEFFUyA9IHJlcXVpcmUoJ2Flcy1qcycpXG5jb25zdCBnZW5BRVNLZXkgPSByZXF1aXJlKCcuL2dlbl9hZXNfa2V5JylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoeyBwYXNzd29yZCwgY3JlZGVudGlhbHMgfSkgPT4ge1xuICBjb25zdCB7IGNpZCwga2V5LCBzZWNyZXQsIG1ldGEgfSA9IGNyZWRlbnRpYWxzXG4gIGNvbnN0IGFlc0tleSA9IGF3YWl0IGdlbkFFU0tleShwYXNzd29yZClcblxuICBjb25zdCBhZXNDVFIgPSBuZXcgQUVTLk1vZGVPZk9wZXJhdGlvbi5jdHIoYWVzS2V5KSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lXG4gIGNvbnN0IGRlY3J5cHRlZEV4SUQgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKGNpZCkpKVxuICBjb25zdCBkZWNyeXB0ZWRLZXkgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKGtleSkpKVxuICBjb25zdCBkZWNyeXB0ZWRTZWNyZXQgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKHNlY3JldCkpKVxuICBjb25zdCBkZWNyeXB0ZWRDb250cm9sID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhtZXRhKSkpXG5cbiAgaWYgKGRlY3J5cHRlZENvbnRyb2wgIT09ICdjb250cm9sJykge1xuICAgIHJldHVybiBudWxsXG4gIH1cblxuICByZXR1cm4ge1xuICAgIGV4SUQ6IGRlY3J5cHRlZEV4SUQsXG4gICAga2V5OiBkZWNyeXB0ZWRLZXksXG4gICAgc2VjcmV0OiBkZWNyeXB0ZWRTZWNyZXRcbiAgfVxufVxuIl19