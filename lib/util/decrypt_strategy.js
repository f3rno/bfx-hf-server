'use strict';

const AES = require('aes-js');
const genAESKey = require('./gen_aes_key');

module.exports = async (strategy, password) => {
  const {
    id, label, cryptedLabel, defineIndicators, onPriceUpdate, onEnter, onUpdate,
    onUpdateLong, onUpdateShort, onUpdateClosing, onPositionOpen,
    onPositionUpdate, onPositionClose, onStart, onStop } =
  strategy;

  const aesKey = await genAESKey(password);
  const aesCTR = new AES.ModeOfOperation.ctr(aesKey); // eslint-disable-line

  const decryptedLabel = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(cryptedLabel)));

  if (decryptedLabel !== label) {
    return null;
  }

  const decryptedDefineIndicators = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(defineIndicators)));
  const decryptedOnPriceUpdate = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onPriceUpdate)));
  const decryptedOnEnter = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onEnter)));
  const decryptedOnUpdate = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onUpdate)));
  const decryptedOnUpdateLong = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onUpdateLong)));
  const decryptedOnUpdateShort = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onUpdateShort)));
  const decryptedOnUpdateClosing = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onUpdateClosing)));
  const decryptedOnPositionOpen = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onPositionOpen)));
  const decryptedOnPositionUpdate = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onPositionUpdate)));
  const decryptedOnPositionClose = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onPositionClose)));
  const decryptedOnStart = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onStart)));
  const decryptedOnStop = AES.utils.utf8.fromBytes(aesCTR.decrypt(AES.utils.hex.toBytes(onStop)));

  return {
    id,
    label,
    defineIndicators: decryptedDefineIndicators,
    onPriceUpdate: decryptedOnPriceUpdate,
    onEnter: decryptedOnEnter,
    onUpdate: decryptedOnUpdate,
    onUpdateLong: decryptedOnUpdateLong,
    onUpdateShort: decryptedOnUpdateShort,
    onUpdateClosing: decryptedOnUpdateClosing,
    onPositionOpen: decryptedOnPositionOpen,
    onPositionUpdate: decryptedOnPositionUpdate,
    onPositionClose: decryptedOnPositionClose,
    onStart: decryptedOnStart,
    onStop: decryptedOnStop };

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2RlY3J5cHRfc3RyYXRlZ3kuanMiXSwibmFtZXMiOlsiQUVTIiwicmVxdWlyZSIsImdlbkFFU0tleSIsIm1vZHVsZSIsImV4cG9ydHMiLCJzdHJhdGVneSIsInBhc3N3b3JkIiwiaWQiLCJsYWJlbCIsImNyeXB0ZWRMYWJlbCIsImRlZmluZUluZGljYXRvcnMiLCJvblByaWNlVXBkYXRlIiwib25FbnRlciIsIm9uVXBkYXRlIiwib25VcGRhdGVMb25nIiwib25VcGRhdGVTaG9ydCIsIm9uVXBkYXRlQ2xvc2luZyIsIm9uUG9zaXRpb25PcGVuIiwib25Qb3NpdGlvblVwZGF0ZSIsIm9uUG9zaXRpb25DbG9zZSIsIm9uU3RhcnQiLCJvblN0b3AiLCJhZXNLZXkiLCJhZXNDVFIiLCJNb2RlT2ZPcGVyYXRpb24iLCJjdHIiLCJkZWNyeXB0ZWRMYWJlbCIsInV0aWxzIiwidXRmOCIsImZyb21CeXRlcyIsImRlY3J5cHQiLCJoZXgiLCJ0b0J5dGVzIiwiZGVjcnlwdGVkRGVmaW5lSW5kaWNhdG9ycyIsImRlY3J5cHRlZE9uUHJpY2VVcGRhdGUiLCJkZWNyeXB0ZWRPbkVudGVyIiwiZGVjcnlwdGVkT25VcGRhdGUiLCJkZWNyeXB0ZWRPblVwZGF0ZUxvbmciLCJkZWNyeXB0ZWRPblVwZGF0ZVNob3J0IiwiZGVjcnlwdGVkT25VcGRhdGVDbG9zaW5nIiwiZGVjcnlwdGVkT25Qb3NpdGlvbk9wZW4iLCJkZWNyeXB0ZWRPblBvc2l0aW9uVXBkYXRlIiwiZGVjcnlwdGVkT25Qb3NpdGlvbkNsb3NlIiwiZGVjcnlwdGVkT25TdGFydCIsImRlY3J5cHRlZE9uU3RvcCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsTUFBTUEsR0FBRyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFuQjtBQUNBLE1BQU1DLFNBQVMsR0FBR0QsT0FBTyxDQUFDLGVBQUQsQ0FBekI7O0FBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPQyxRQUFQLEVBQWlCQyxRQUFq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TyxFQUFFdUIsZ0JBTEo7QUFNTHRCLElBQUFBLFFBQVEsRUFBRXVCLGlCQU5MO0FBT0x0QixJQUFBQSxZQUFZLEVBQUV1QixxQkFQVDtBQVFMdEIsSUFBQUEsYUFBYSxFQUFFdUIsc0JBUlY7QUFTTHRCLElBQUFBLGVBQWUsRUFBRXVCLHdCQVRaO0FBVUx0QixJQUFBQSxjQUFjLEVBQUV1Qix1QkFWWDtBQVdMdEIsSUFBQUEsZ0JBQWdCLEVBQUV1Qix5QkFYYjtBQVlMdEIsSUFBQUEsZUFBZSxFQUFFdUIsd0JBWlo7QUFhTHRCLElBQUFBLE9BQU8sRUFBRXVCLGdCQWJKO0FBY0x0QixJQUFBQSxNQUFNLEVBQUV1QixlQWRILEVBQVA7O0FBZ0JELENBN0NEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IEFFUyA9IHJlcXVpcmUoJ2Flcy1qcycpXG5jb25zdCBnZW5BRVNLZXkgPSByZXF1aXJlKCcuL2dlbl9hZXNfa2V5JylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoc3RyYXRlZ3ksIHBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHtcbiAgICBpZCwgbGFiZWwsIGNyeXB0ZWRMYWJlbCwgZGVmaW5lSW5kaWNhdG9ycywgb25QcmljZVVwZGF0ZSwgb25FbnRlciwgb25VcGRhdGUsXG4gICAgb25VcGRhdGVMb25nLCBvblVwZGF0ZVNob3J0LCBvblVwZGF0ZUNsb3NpbmcsIG9uUG9zaXRpb25PcGVuLFxuICAgIG9uUG9zaXRpb25VcGRhdGUsIG9uUG9zaXRpb25DbG9zZSwgb25TdGFydCwgb25TdG9wXG4gIH0gPSBzdHJhdGVneVxuXG4gIGNvbnN0IGFlc0tleSA9IGF3YWl0IGdlbkFFU0tleShwYXNzd29yZClcbiAgY29uc3QgYWVzQ1RSID0gbmV3IEFFUy5Nb2RlT2ZPcGVyYXRpb24uY3RyKGFlc0tleSkgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuXG4gIGNvbnN0IGRlY3J5cHRlZExhYmVsID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhjcnlwdGVkTGFiZWwpKSlcblxuICBpZiAoZGVjcnlwdGVkTGFiZWwgIT09IGxhYmVsKSB7XG4gICAgcmV0dXJuIG51bGxcbiAgfVxuXG4gIGNvbnN0IGRlY3J5cHRlZERlZmluZUluZGljYXRvcnMgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKGRlZmluZUluZGljYXRvcnMpKSlcbiAgY29uc3QgZGVjcnlwdGVkT25QcmljZVVwZGF0ZSA9IEFFUy51dGlscy51dGY4LmZyb21CeXRlcyhhZXNDVFIuZGVjcnlwdChBRVMudXRpbHMuaGV4LnRvQnl0ZXMob25QcmljZVVwZGF0ZSkpKVxuICBjb25zdCBkZWNyeXB0ZWRPbkVudGVyID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvbkVudGVyKSkpXG4gIGNvbnN0IGRlY3J5cHRlZE9uVXBkYXRlID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvblVwZGF0ZSkpKVxuICBjb25zdCBkZWNyeXB0ZWRPblVwZGF0ZUxvbmcgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKG9uVXBkYXRlTG9uZykpKVxuICBjb25zdCBkZWNyeXB0ZWRPblVwZGF0ZVNob3J0ID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvblVwZGF0ZVNob3J0KSkpXG4gIGNvbnN0IGRlY3J5cHRlZE9uVXBkYXRlQ2xvc2luZyA9IEFFUy51dGlscy51dGY4LmZyb21CeXRlcyhhZXNDVFIuZGVjcnlwdChBRVMudXRpbHMuaGV4LnRvQnl0ZXMob25VcGRhdGVDbG9zaW5nKSkpXG4gIGNvbnN0IGRlY3J5cHRlZE9uUG9zaXRpb25PcGVuID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvblBvc2l0aW9uT3BlbikpKVxuICBjb25zdCBkZWNyeXB0ZWRPblBvc2l0aW9uVXBkYXRlID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvblBvc2l0aW9uVXBkYXRlKSkpXG4gIGNvbnN0IGRlY3J5cHRlZE9uUG9zaXRpb25DbG9zZSA9IEFFUy51dGlscy51dGY4LmZyb21CeXRlcyhhZXNDVFIuZGVjcnlwdChBRVMudXRpbHMuaGV4LnRvQnl0ZXMob25Qb3NpdGlvbkNsb3NlKSkpXG4gIGNvbnN0IGRlY3J5cHRlZE9uU3RhcnQgPSBBRVMudXRpbHMudXRmOC5mcm9tQnl0ZXMoYWVzQ1RSLmRlY3J5cHQoQUVTLnV0aWxzLmhleC50b0J5dGVzKG9uU3RhcnQpKSlcbiAgY29uc3QgZGVjcnlwdGVkT25TdG9wID0gQUVTLnV0aWxzLnV0ZjguZnJvbUJ5dGVzKGFlc0NUUi5kZWNyeXB0KEFFUy51dGlscy5oZXgudG9CeXRlcyhvblN0b3ApKSlcblxuICByZXR1cm4ge1xuICAgIGlkLFxuICAgIGxhYmVsLFxuICAgIGRlZmluZUluZGljYXRvcnM6IGRlY3J5cHRlZERlZmluZUluZGljYXRvcnMsXG4gICAgb25QcmljZVVwZGF0ZTogZGVjcnlwdGVkT25QcmljZVVwZGF0ZSxcbiAgICBvbkVudGVyOiBkZWNyeXB0ZWRPbkVudGVyLFxuICAgIG9uVXBkYXRlOiBkZWNyeXB0ZWRPblVwZGF0ZSxcbiAgICBvblVwZGF0ZUxvbmc6IGRlY3J5cHRlZE9uVXBkYXRlTG9uZyxcbiAgICBvblVwZGF0ZVNob3J0OiBkZWNyeXB0ZWRPblVwZGF0ZVNob3J0LFxuICAgIG9uVXBkYXRlQ2xvc2luZzogZGVjcnlwdGVkT25VcGRhdGVDbG9zaW5nLFxuICAgIG9uUG9zaXRpb25PcGVuOiBkZWNyeXB0ZWRPblBvc2l0aW9uT3BlbixcbiAgICBvblBvc2l0aW9uVXBkYXRlOiBkZWNyeXB0ZWRPblBvc2l0aW9uVXBkYXRlLFxuICAgIG9uUG9zaXRpb25DbG9zZTogZGVjcnlwdGVkT25Qb3NpdGlvbkNsb3NlLFxuICAgIG9uU3RhcnQ6IGRlY3J5cHRlZE9uU3RhcnQsXG4gICAgb25TdG9wOiBkZWNyeXB0ZWRPblN0b3BcbiAgfVxufVxuIl19