'use strict';

const Promise = require('bluebird');
const scrypt = require('scrypt-js');
const buffer = require('scrypt-js/thirdparty/buffer');

// TODO: Unique salt; used to be the user.id
const SALT = 'salt';

module.exports = password => {
  const pwBuff = new buffer.SlowBuffer(password.normalize('NFKC'));
  const saltBuff = new buffer.SlowBuffer(SALT.normalize('NFKC'));

  return new Promise((resolve, reject) => {
    scrypt(pwBuff, saltBuff, 1024, 8, 1, 32, (error, progress, key) => {
      if (error) {
        return reject(new Error(error));
      }

      if (!key) {
        return;
      }

      resolve(key);
    });
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL2dlbl9hZXNfa2V5LmpzIl0sIm5hbWVzIjpbIlByb21pc2UiLCJyZXF1aXJlIiwic2NyeXB0IiwiYnVmZmVyIiwiU0FMVCIsIm1vZHVsZSIsImV4cG9ydHMiLCJwYXNzd29yZCIsInB3QnVmZiIsIlNsb3dCdWZmZXIiLCJub3JtYWxpemUiLCJzYWx0QnVmZiIsInJlc29sdmUiLCJyZWplY3QiLCJlcnJvciIsInByb2dyZXNzIiwia2V5IiwiRXJyb3IiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBdkI7QUFDQSxNQUFNQyxNQUFNLEdBQUdELE9BQU8sQ0FBQyxXQUFELENBQXRCO0FBQ0EsTUFBTUUsTUFBTSxHQUFHRixPQUFPLENBQUMsNkJBQUQsQ0FBdEI7O0FBRUE7QUFDQSxNQUFNRyxJQUFJLEdBQUcsTUFBYjs7QUFFQUMsTUFBTSxDQUFDQyxPQUFQLEdBQWtCQyxRQUFELElBQWM7QUFDN0IsUUFBTUMsTUFBTSxHQUFHLElBQUlMLE1BQU0sQ0FBQ00sVUFBWCxDQUFzQkYsUUFBUSxDQUFDRyxTQUFULENBQW1CLE1BQW5CLENBQXRCLENBQWY7QUFDQSxRQUFNQyxRQUFRLEdBQUcsSUFBSVIsTUFBTSxDQUFDTSxVQUFYLENBQXNCTCxJQUFJLENBQUNNLFNBQUwsQ0FBZSxNQUFmLENBQXRCLENBQWpCOztBQUVBLFNBQU8sSUFBSVYsT0FBSixDQUFZLENBQUNZLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUN0Q1gsSUFBQUEsTUFBTSxDQUFDTSxNQUFELEVBQVNHLFFBQVQsRUFBbUIsSUFBbkIsRUFBeUIsQ0FBekIsRUFBNEIsQ0FBNUIsRUFBK0IsRUFBL0IsRUFBbUMsQ0FBQ0csS0FBRCxFQUFRQyxRQUFSLEVBQWtCQyxHQUFsQixLQUEwQjtBQUNqRSxVQUFJRixLQUFKLEVBQVc7QUFDVCxlQUFPRCxNQUFNLENBQUMsSUFBSUksS0FBSixDQUFVSCxLQUFWLENBQUQsQ0FBYjtBQUNEOztBQUVELFVBQUksQ0FBQ0UsR0FBTCxFQUFVO0FBQ1I7QUFDRDs7QUFFREosTUFBQUEsT0FBTyxDQUFDSSxHQUFELENBQVA7QUFDRCxLQVZLLENBQU47QUFXRCxHQVpNLENBQVA7QUFhRCxDQWpCRCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuXG5jb25zdCBQcm9taXNlID0gcmVxdWlyZSgnYmx1ZWJpcmQnKVxuY29uc3Qgc2NyeXB0ID0gcmVxdWlyZSgnc2NyeXB0LWpzJylcbmNvbnN0IGJ1ZmZlciA9IHJlcXVpcmUoJ3NjcnlwdC1qcy90aGlyZHBhcnR5L2J1ZmZlcicpXG5cbi8vIFRPRE86IFVuaXF1ZSBzYWx0OyB1c2VkIHRvIGJlIHRoZSB1c2VyLmlkXG5jb25zdCBTQUxUID0gJ3NhbHQnXG5cbm1vZHVsZS5leHBvcnRzID0gKHBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHB3QnVmZiA9IG5ldyBidWZmZXIuU2xvd0J1ZmZlcihwYXNzd29yZC5ub3JtYWxpemUoJ05GS0MnKSlcbiAgY29uc3Qgc2FsdEJ1ZmYgPSBuZXcgYnVmZmVyLlNsb3dCdWZmZXIoU0FMVC5ub3JtYWxpemUoJ05GS0MnKSlcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHNjcnlwdChwd0J1ZmYsIHNhbHRCdWZmLCAxMDI0LCA4LCAxLCAzMiwgKGVycm9yLCBwcm9ncmVzcywga2V5KSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChuZXcgRXJyb3IoZXJyb3IpKVxuICAgICAgfVxuXG4gICAgICBpZiAoIWtleSkge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgcmVzb2x2ZShrZXkpXG4gICAgfSlcbiAgfSlcbn1cbiJdfQ==