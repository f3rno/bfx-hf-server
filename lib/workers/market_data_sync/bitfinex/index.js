'use strict';

const capture = require('../../../capture');
const EXA = require('../../../exchange_clients/bitfinex');
const forEachMarketTF = require('../../../exchange_clients/for_each_market_tf');
const getFirstCandle = require('./get_first_candle');
const fetchLoop = require('./fetch_loop');

module.exports = async db => {
  return forEachMarketTF(db, EXA, async (market, tf) => {
    let firstCandle;

    try {
      firstCandle = await getFirstCandle(market.restID, tf);
      await fetchLoop(firstCandle ? +firstCandle.mts : 0, market, tf);
    } catch (e) {
      capture.exception(e);
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy93b3JrZXJzL21hcmtldF9kYXRhX3N5bmMvYml0ZmluZXgvaW5kZXguanMiXSwibmFtZXMiOlsiY2FwdHVyZSIsInJlcXVpcmUiLCJFWEEiLCJmb3JFYWNoTWFya2V0VEYiLCJnZXRGaXJzdENhbmRsZSIsImZldGNoTG9vcCIsIm1vZHVsZSIsImV4cG9ydHMiLCJkYiIsIm1hcmtldCIsInRmIiwiZmlyc3RDYW5kbGUiLCJyZXN0SUQiLCJtdHMiLCJlIiwiZXhjZXB0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxrQkFBRCxDQUF2QjtBQUNBLE1BQU1DLEdBQUcsR0FBR0QsT0FBTyxDQUFDLG9DQUFELENBQW5CO0FBQ0EsTUFBTUUsZUFBZSxHQUFHRixPQUFPLENBQUMsOENBQUQsQ0FBL0I7QUFDQSxNQUFNRyxjQUFjLEdBQUdILE9BQU8sQ0FBQyxvQkFBRCxDQUE5QjtBQUNBLE1BQU1JLFNBQVMsR0FBR0osT0FBTyxDQUFDLGNBQUQsQ0FBekI7O0FBRUFLLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixNQUFPQyxFQUFQLElBQWM7QUFDN0IsU0FBT0wsZUFBZSxDQUFDSyxFQUFELEVBQUtOLEdBQUwsRUFBVSxPQUFPTyxNQUFQLEVBQWVDLEVBQWYsS0FBc0I7QUFDcEQsUUFBSUMsV0FBSjs7QUFFQSxRQUFJO0FBQ0ZBLE1BQUFBLFdBQVcsR0FBRyxNQUFNUCxjQUFjLENBQUNLLE1BQU0sQ0FBQ0csTUFBUixFQUFnQkYsRUFBaEIsQ0FBbEM7QUFDQSxZQUFNTCxTQUFTLENBQUNNLFdBQVcsR0FBRyxDQUFDQSxXQUFXLENBQUNFLEdBQWhCLEdBQXNCLENBQWxDLEVBQXFDSixNQUFyQyxFQUE2Q0MsRUFBN0MsQ0FBZjtBQUNELEtBSEQsQ0FHRSxPQUFPSSxDQUFQLEVBQVU7QUFDVmQsTUFBQUEsT0FBTyxDQUFDZSxTQUFSLENBQWtCRCxDQUFsQjtBQUNEO0FBQ0YsR0FUcUIsQ0FBdEI7QUFVRCxDQVhEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IGNhcHR1cmUgPSByZXF1aXJlKCcuLi8uLi8uLi9jYXB0dXJlJylcbmNvbnN0IEVYQSA9IHJlcXVpcmUoJy4uLy4uLy4uL2V4Y2hhbmdlX2NsaWVudHMvYml0ZmluZXgnKVxuY29uc3QgZm9yRWFjaE1hcmtldFRGID0gcmVxdWlyZSgnLi4vLi4vLi4vZXhjaGFuZ2VfY2xpZW50cy9mb3JfZWFjaF9tYXJrZXRfdGYnKVxuY29uc3QgZ2V0Rmlyc3RDYW5kbGUgPSByZXF1aXJlKCcuL2dldF9maXJzdF9jYW5kbGUnKVxuY29uc3QgZmV0Y2hMb29wID0gcmVxdWlyZSgnLi9mZXRjaF9sb29wJylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoZGIpID0+IHtcbiAgcmV0dXJuIGZvckVhY2hNYXJrZXRURihkYiwgRVhBLCBhc3luYyAobWFya2V0LCB0ZikgPT4ge1xuICAgIGxldCBmaXJzdENhbmRsZVxuXG4gICAgdHJ5IHtcbiAgICAgIGZpcnN0Q2FuZGxlID0gYXdhaXQgZ2V0Rmlyc3RDYW5kbGUobWFya2V0LnJlc3RJRCwgdGYpXG4gICAgICBhd2FpdCBmZXRjaExvb3AoZmlyc3RDYW5kbGUgPyArZmlyc3RDYW5kbGUubXRzIDogMCwgbWFya2V0LCB0ZilcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjYXB0dXJlLmV4Y2VwdGlvbihlKVxuICAgIH1cbiAgfSlcbn1cbiJdfQ==