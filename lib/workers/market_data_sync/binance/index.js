'use strict';

const capture = require('../../../capture');
const EXA = require('../../../exchange_clients/binance');
const forEachMarketTF = require('../../../exchange_clients/for_each_market_tf');
const getFirstCandle = require('./get_first_candle');
const fetchLoop = require('./fetch_loop');

module.exports = async db => {
  return forEachMarketTF(db, EXA, async (market, tf) => {
    let firstCandle;

    try {
      firstCandle = await getFirstCandle(market.restID, tf);
      await fetchLoop(firstCandle ? +firstCandle.mts : 0, market, tf);
    } catch (e) {
      capture.exception(e);
    }
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy93b3JrZXJzL21hcmtldF9kYXRhX3N5bmMvYmluYW5jZS9pbmRleC5qcyJdLCJuYW1lcyI6WyJjYXB0dXJlIiwicmVxdWlyZSIsIkVYQSIsImZvckVhY2hNYXJrZXRURiIsImdldEZpcnN0Q2FuZGxlIiwiZmV0Y2hMb29wIiwibW9kdWxlIiwiZXhwb3J0cyIsImRiIiwibWFya2V0IiwidGYiLCJmaXJzdENhbmRsZSIsInJlc3RJRCIsIm10cyIsImUiLCJleGNlcHRpb24iXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLGtCQUFELENBQXZCO0FBQ0EsTUFBTUMsR0FBRyxHQUFHRCxPQUFPLENBQUMsbUNBQUQsQ0FBbkI7QUFDQSxNQUFNRSxlQUFlLEdBQUdGLE9BQU8sQ0FBQyw4Q0FBRCxDQUEvQjtBQUNBLE1BQU1HLGNBQWMsR0FBR0gsT0FBTyxDQUFDLG9CQUFELENBQTlCO0FBQ0EsTUFBTUksU0FBUyxHQUFHSixPQUFPLENBQUMsY0FBRCxDQUF6Qjs7QUFFQUssTUFBTSxDQUFDQyxPQUFQLEdBQWlCLE1BQU9DLEVBQVAsSUFBYztBQUM3QixTQUFPTCxlQUFlLENBQUNLLEVBQUQsRUFBS04sR0FBTCxFQUFVLE9BQU9PLE1BQVAsRUFBZUMsRUFBZixLQUFzQjtBQUNwRCxRQUFJQyxXQUFKOztBQUVBLFFBQUk7QUFDRkEsTUFBQUEsV0FBVyxHQUFHLE1BQU1QLGNBQWMsQ0FBQ0ssTUFBTSxDQUFDRyxNQUFSLEVBQWdCRixFQUFoQixDQUFsQztBQUNBLFlBQU1MLFNBQVMsQ0FBQ00sV0FBVyxHQUFHLENBQUNBLFdBQVcsQ0FBQ0UsR0FBaEIsR0FBc0IsQ0FBbEMsRUFBcUNKLE1BQXJDLEVBQTZDQyxFQUE3QyxDQUFmO0FBQ0QsS0FIRCxDQUdFLE9BQU9JLENBQVAsRUFBVTtBQUNWZCxNQUFBQSxPQUFPLENBQUNlLFNBQVIsQ0FBa0JELENBQWxCO0FBQ0Q7QUFDRixHQVRxQixDQUF0QjtBQVVELENBWEQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCdcblxuY29uc3QgY2FwdHVyZSA9IHJlcXVpcmUoJy4uLy4uLy4uL2NhcHR1cmUnKVxuY29uc3QgRVhBID0gcmVxdWlyZSgnLi4vLi4vLi4vZXhjaGFuZ2VfY2xpZW50cy9iaW5hbmNlJylcbmNvbnN0IGZvckVhY2hNYXJrZXRURiA9IHJlcXVpcmUoJy4uLy4uLy4uL2V4Y2hhbmdlX2NsaWVudHMvZm9yX2VhY2hfbWFya2V0X3RmJylcbmNvbnN0IGdldEZpcnN0Q2FuZGxlID0gcmVxdWlyZSgnLi9nZXRfZmlyc3RfY2FuZGxlJylcbmNvbnN0IGZldGNoTG9vcCA9IHJlcXVpcmUoJy4vZmV0Y2hfbG9vcCcpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGRiKSA9PiB7XG4gIHJldHVybiBmb3JFYWNoTWFya2V0VEYoZGIsIEVYQSwgYXN5bmMgKG1hcmtldCwgdGYpID0+IHtcbiAgICBsZXQgZmlyc3RDYW5kbGVcblxuICAgIHRyeSB7XG4gICAgICBmaXJzdENhbmRsZSA9IGF3YWl0IGdldEZpcnN0Q2FuZGxlKG1hcmtldC5yZXN0SUQsIHRmKVxuICAgICAgYXdhaXQgZmV0Y2hMb29wKGZpcnN0Q2FuZGxlID8gK2ZpcnN0Q2FuZGxlLm10cyA6IDAsIG1hcmtldCwgdGYpXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2FwdHVyZS5leGNlcHRpb24oZSlcbiAgICB9XG4gIH0pXG59XG4iXX0=