'use strict';

const _isFinite = require('lodash/isFinite');
const dbRL = require('../pg_rate_limited');

module.exports = async ({
  table, market, start, end, limit, order = 'asc', orderBy = 'mts' }) =>
{
  return dbRL(db => {
    const q = db(table).
    where(b => {
      let qb = b.where('symbol', market.restID);

      if (_isFinite(start)) {
        qb = qb.andWhere('mts', '>=', start);
      }

      if (_isFinite(end)) {
        qb = qb.andWhere('mts', '<=', end);
      }

      return qb;
    }).
    orderBy(orderBy, order);

    if (_isFinite(limit)) {
      q.limit(limit);
    }

    return q.select('*');
  });
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kYi9xdWVyeV9jYW5kbGVzL2ZldGNoLmpzIl0sIm5hbWVzIjpbIl9pc0Zpbml0ZSIsInJlcXVpcmUiLCJkYlJMIiwibW9kdWxlIiwiZXhwb3J0cyIsInRhYmxlIiwibWFya2V0Iiwic3RhcnQiLCJlbmQiLCJsaW1pdCIsIm9yZGVyIiwib3JkZXJCeSIsImRiIiwicSIsIndoZXJlIiwiYiIsInFiIiwicmVzdElEIiwiYW5kV2hlcmUiLCJzZWxlY3QiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLE1BQU1BLFNBQVMsR0FBR0MsT0FBTyxDQUFDLGlCQUFELENBQXpCO0FBQ0EsTUFBTUMsSUFBSSxHQUFHRCxPQUFPLENBQUMsb0JBQUQsQ0FBcEI7O0FBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQixPQUFPO0FBQ3RCQyxFQUFBQSxLQURzQixFQUNmQyxNQURlLEVBQ1BDLEtBRE8sRUFDQUMsR0FEQSxFQUNLQyxLQURMLEVBQ1lDLEtBQUssR0FBRyxLQURwQixFQUMyQkMsT0FBTyxHQUFHLEtBRHJDLEVBQVA7QUFFWDtBQUNKLFNBQU9ULElBQUksQ0FBRVUsRUFBRCxJQUFRO0FBQ2xCLFVBQU1DLENBQUMsR0FBR0QsRUFBRSxDQUFDUCxLQUFELENBQUY7QUFDUFMsSUFBQUEsS0FETyxDQUNEQyxDQUFDLElBQUk7QUFDVixVQUFJQyxFQUFFLEdBQUdELENBQUMsQ0FBQ0QsS0FBRixDQUFRLFFBQVIsRUFBa0JSLE1BQU0sQ0FBQ1csTUFBekIsQ0FBVDs7QUFFQSxVQUFJakIsU0FBUyxDQUFDTyxLQUFELENBQWIsRUFBc0I7QUFDcEJTLFFBQUFBLEVBQUUsR0FBR0EsRUFBRSxDQUFDRSxRQUFILENBQVksS0FBWixFQUFtQixJQUFuQixFQUF5QlgsS0FBekIsQ0FBTDtBQUNEOztBQUVELFVBQUlQLFNBQVMsQ0FBQ1EsR0FBRCxDQUFiLEVBQW9CO0FBQ2xCUSxRQUFBQSxFQUFFLEdBQUdBLEVBQUUsQ0FBQ0UsUUFBSCxDQUFZLEtBQVosRUFBbUIsSUFBbkIsRUFBeUJWLEdBQXpCLENBQUw7QUFDRDs7QUFFRCxhQUFPUSxFQUFQO0FBQ0QsS0FiTztBQWNQTCxJQUFBQSxPQWRPLENBY0NBLE9BZEQsRUFjVUQsS0FkVixDQUFWOztBQWdCQSxRQUFJVixTQUFTLENBQUNTLEtBQUQsQ0FBYixFQUFzQjtBQUNwQkksTUFBQUEsQ0FBQyxDQUFDSixLQUFGLENBQVFBLEtBQVI7QUFDRDs7QUFFRCxXQUFPSSxDQUFDLENBQUNNLE1BQUYsQ0FBUyxHQUFULENBQVA7QUFDRCxHQXRCVSxDQUFYO0FBdUJELENBMUJEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IF9pc0Zpbml0ZSA9IHJlcXVpcmUoJ2xvZGFzaC9pc0Zpbml0ZScpXG5jb25zdCBkYlJMID0gcmVxdWlyZSgnLi4vcGdfcmF0ZV9saW1pdGVkJylcblxubW9kdWxlLmV4cG9ydHMgPSBhc3luYyAoe1xuICB0YWJsZSwgbWFya2V0LCBzdGFydCwgZW5kLCBsaW1pdCwgb3JkZXIgPSAnYXNjJywgb3JkZXJCeSA9ICdtdHMnXG59KSA9PiB7XG4gIHJldHVybiBkYlJMKChkYikgPT4ge1xuICAgIGNvbnN0IHEgPSBkYih0YWJsZSlcbiAgICAgIC53aGVyZShiID0+IHtcbiAgICAgICAgbGV0IHFiID0gYi53aGVyZSgnc3ltYm9sJywgbWFya2V0LnJlc3RJRClcblxuICAgICAgICBpZiAoX2lzRmluaXRlKHN0YXJ0KSkge1xuICAgICAgICAgIHFiID0gcWIuYW5kV2hlcmUoJ210cycsICc+PScsIHN0YXJ0KVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9pc0Zpbml0ZShlbmQpKSB7XG4gICAgICAgICAgcWIgPSBxYi5hbmRXaGVyZSgnbXRzJywgJzw9JywgZW5kKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHFiXG4gICAgICB9KVxuICAgICAgLm9yZGVyQnkob3JkZXJCeSwgb3JkZXIpXG5cbiAgICBpZiAoX2lzRmluaXRlKGxpbWl0KSkge1xuICAgICAgcS5saW1pdChsaW1pdClcbiAgICB9XG5cbiAgICByZXR1cm4gcS5zZWxlY3QoJyonKVxuICB9KVxufVxuIl19