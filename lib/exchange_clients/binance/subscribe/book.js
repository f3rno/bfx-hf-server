'use strict';

const nonce = require('../../../util/nonce');
const chanDataToKey = require('../../../util/chan_data_to_key');

const recvBookData = require('../recv_data/book');

module.exports = (exa, channelData) => {
  const { d, subs, unsubs, client } = exa;
  const key = chanDataToKey(channelData);
  const [, market] = channelData;
  const symbol = market.wsID;
  const chanID = nonce();

  d('subscribing to book channel %s', symbol);

  subs[key] = chanID;
  unsubs[key] = client.ws.partialDepth({
    symbol,
    level: 20 },
  book => recvBookData(exa, chanID, book));

  return chanID;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9leGNoYW5nZV9jbGllbnRzL2JpbmFuY2Uvc3Vic2NyaWJlL2Jvb2suanMiXSwibmFtZXMiOlsibm9uY2UiLCJyZXF1aXJlIiwiY2hhbkRhdGFUb0tleSIsInJlY3ZCb29rRGF0YSIsIm1vZHVsZSIsImV4cG9ydHMiLCJleGEiLCJjaGFubmVsRGF0YSIsImQiLCJzdWJzIiwidW5zdWJzIiwiY2xpZW50Iiwia2V5IiwibWFya2V0Iiwic3ltYm9sIiwid3NJRCIsImNoYW5JRCIsIndzIiwicGFydGlhbERlcHRoIiwibGV2ZWwiLCJib29rIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxxQkFBRCxDQUFyQjtBQUNBLE1BQU1DLGFBQWEsR0FBR0QsT0FBTyxDQUFDLGdDQUFELENBQTdCOztBQUVBLE1BQU1FLFlBQVksR0FBR0YsT0FBTyxDQUFDLG1CQUFELENBQTVCOztBQUVBRyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsQ0FBQ0MsR0FBRCxFQUFNQyxXQUFOLEtBQXNCO0FBQ3JDLFFBQU0sRUFBRUMsQ0FBRixFQUFLQyxJQUFMLEVBQVdDLE1BQVgsRUFBbUJDLE1BQW5CLEtBQThCTCxHQUFwQztBQUNBLFFBQU1NLEdBQUcsR0FBR1YsYUFBYSxDQUFDSyxXQUFELENBQXpCO0FBQ0EsUUFBTSxHQUFHTSxNQUFILElBQWFOLFdBQW5CO0FBQ0EsUUFBTU8sTUFBTSxHQUFHRCxNQUFNLENBQUNFLElBQXRCO0FBQ0EsUUFBTUMsTUFBTSxHQUFHaEIsS0FBSyxFQUFwQjs7QUFFQVEsRUFBQUEsQ0FBQyxDQUFDLGdDQUFELEVBQW1DTSxNQUFuQyxDQUFEOztBQUVBTCxFQUFBQSxJQUFJLENBQUNHLEdBQUQsQ0FBSixHQUFZSSxNQUFaO0FBQ0FOLEVBQUFBLE1BQU0sQ0FBQ0UsR0FBRCxDQUFOLEdBQWNELE1BQU0sQ0FBQ00sRUFBUCxDQUFVQyxZQUFWLENBQXVCO0FBQ25DSixJQUFBQSxNQURtQztBQUVuQ0ssSUFBQUEsS0FBSyxFQUFFLEVBRjRCLEVBQXZCO0FBR1ZDLEVBQUFBLElBQUQsSUFBVWpCLFlBQVksQ0FBQ0csR0FBRCxFQUFNVSxNQUFOLEVBQWNJLElBQWQsQ0FIWCxDQUFkOztBQUtBLFNBQU9KLE1BQVA7QUFDRCxDQWhCRCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0J1xuXG5jb25zdCBub25jZSA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWwvbm9uY2UnKVxuY29uc3QgY2hhbkRhdGFUb0tleSA9IHJlcXVpcmUoJy4uLy4uLy4uL3V0aWwvY2hhbl9kYXRhX3RvX2tleScpXG5cbmNvbnN0IHJlY3ZCb29rRGF0YSA9IHJlcXVpcmUoJy4uL3JlY3ZfZGF0YS9ib29rJylcblxubW9kdWxlLmV4cG9ydHMgPSAoZXhhLCBjaGFubmVsRGF0YSkgPT4ge1xuICBjb25zdCB7IGQsIHN1YnMsIHVuc3VicywgY2xpZW50IH0gPSBleGFcbiAgY29uc3Qga2V5ID0gY2hhbkRhdGFUb0tleShjaGFubmVsRGF0YSlcbiAgY29uc3QgWywgbWFya2V0XSA9IGNoYW5uZWxEYXRhXG4gIGNvbnN0IHN5bWJvbCA9IG1hcmtldC53c0lEXG4gIGNvbnN0IGNoYW5JRCA9IG5vbmNlKClcblxuICBkKCdzdWJzY3JpYmluZyB0byBib29rIGNoYW5uZWwgJXMnLCBzeW1ib2wpXG5cbiAgc3Vic1trZXldID0gY2hhbklEXG4gIHVuc3Vic1trZXldID0gY2xpZW50LndzLnBhcnRpYWxEZXB0aCh7XG4gICAgc3ltYm9sLFxuICAgIGxldmVsOiAyMFxuICB9LCAoYm9vaykgPT4gcmVjdkJvb2tEYXRhKGV4YSwgY2hhbklELCBib29rKSlcblxuICByZXR1cm4gY2hhbklEXG59XG4iXX0=