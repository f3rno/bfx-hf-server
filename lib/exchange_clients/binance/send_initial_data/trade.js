'use strict';

const _last = require('lodash/last');
const capture = require('../../../capture');

const tradeTransformer = require('../transformers/trade');
const propagateData = require('../propagate_data');

module.exports = async (exa, channelData, chanID) => {
  const { client } = exa;
  const [, market] = channelData;
  const symbol = market.restID;
  let recentTrades;

  try {
    recentTrades = await client.trades({ symbol });
  } catch (e) {
    capture.exception(e);
    return;
  }

  const trade = _last(recentTrades);
  propagateData(exa, chanID, tradeTransformer(trade));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9leGNoYW5nZV9jbGllbnRzL2JpbmFuY2Uvc2VuZF9pbml0aWFsX2RhdGEvdHJhZGUuanMiXSwibmFtZXMiOlsiX2xhc3QiLCJyZXF1aXJlIiwiY2FwdHVyZSIsInRyYWRlVHJhbnNmb3JtZXIiLCJwcm9wYWdhdGVEYXRhIiwibW9kdWxlIiwiZXhwb3J0cyIsImV4YSIsImNoYW5uZWxEYXRhIiwiY2hhbklEIiwiY2xpZW50IiwibWFya2V0Iiwic3ltYm9sIiwicmVzdElEIiwicmVjZW50VHJhZGVzIiwidHJhZGVzIiwiZSIsImV4Y2VwdGlvbiIsInRyYWRlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxLQUFLLEdBQUdDLE9BQU8sQ0FBQyxhQUFELENBQXJCO0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsa0JBQUQsQ0FBdkI7O0FBRUEsTUFBTUUsZ0JBQWdCLEdBQUdGLE9BQU8sQ0FBQyx1QkFBRCxDQUFoQztBQUNBLE1BQU1HLGFBQWEsR0FBR0gsT0FBTyxDQUFDLG1CQUFELENBQTdCOztBQUVBSSxNQUFNLENBQUNDLE9BQVAsR0FBaUIsT0FBT0MsR0FBUCxFQUFZQyxXQUFaLEVBQXlCQyxNQUF6QixLQUFvQztBQUNuRCxRQUFNLEVBQUVDLE1BQUYsS0FBYUgsR0FBbkI7QUFDQSxRQUFNLEdBQUdJLE1BQUgsSUFBYUgsV0FBbkI7QUFDQSxRQUFNSSxNQUFNLEdBQUdELE1BQU0sQ0FBQ0UsTUFBdEI7QUFDQSxNQUFJQyxZQUFKOztBQUVBLE1BQUk7QUFDRkEsSUFBQUEsWUFBWSxHQUFHLE1BQU1KLE1BQU0sQ0FBQ0ssTUFBUCxDQUFjLEVBQUVILE1BQUYsRUFBZCxDQUFyQjtBQUNELEdBRkQsQ0FFRSxPQUFPSSxDQUFQLEVBQVU7QUFDVmQsSUFBQUEsT0FBTyxDQUFDZSxTQUFSLENBQWtCRCxDQUFsQjtBQUNBO0FBQ0Q7O0FBRUQsUUFBTUUsS0FBSyxHQUFHbEIsS0FBSyxDQUFDYyxZQUFELENBQW5CO0FBQ0FWLEVBQUFBLGFBQWEsQ0FBQ0csR0FBRCxFQUFNRSxNQUFOLEVBQWNOLGdCQUFnQixDQUFDZSxLQUFELENBQTlCLENBQWI7QUFDRCxDQWZEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXG5cbmNvbnN0IF9sYXN0ID0gcmVxdWlyZSgnbG9kYXNoL2xhc3QnKVxuY29uc3QgY2FwdHVyZSA9IHJlcXVpcmUoJy4uLy4uLy4uL2NhcHR1cmUnKVxuXG5jb25zdCB0cmFkZVRyYW5zZm9ybWVyID0gcmVxdWlyZSgnLi4vdHJhbnNmb3JtZXJzL3RyYWRlJylcbmNvbnN0IHByb3BhZ2F0ZURhdGEgPSByZXF1aXJlKCcuLi9wcm9wYWdhdGVfZGF0YScpXG5cbm1vZHVsZS5leHBvcnRzID0gYXN5bmMgKGV4YSwgY2hhbm5lbERhdGEsIGNoYW5JRCkgPT4ge1xuICBjb25zdCB7IGNsaWVudCB9ID0gZXhhXG4gIGNvbnN0IFssIG1hcmtldF0gPSBjaGFubmVsRGF0YVxuICBjb25zdCBzeW1ib2wgPSBtYXJrZXQucmVzdElEXG4gIGxldCByZWNlbnRUcmFkZXNcblxuICB0cnkge1xuICAgIHJlY2VudFRyYWRlcyA9IGF3YWl0IGNsaWVudC50cmFkZXMoeyBzeW1ib2wgfSlcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNhcHR1cmUuZXhjZXB0aW9uKGUpXG4gICAgcmV0dXJuXG4gIH1cblxuICBjb25zdCB0cmFkZSA9IF9sYXN0KHJlY2VudFRyYWRlcylcbiAgcHJvcGFnYXRlRGF0YShleGEsIGNoYW5JRCwgdHJhZGVUcmFuc2Zvcm1lcih0cmFkZSkpXG59XG4iXX0=